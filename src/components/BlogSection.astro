---
import BlogCard from './ui/BlogCard.astro';

const blogPosts = [
  {
    title: "5 Errores Comunes que Te Impiden Perder Peso",
    excerpt: "Descubre los errores más frecuentes en la pérdida de peso y cómo evitarlos para alcanzar tus objetivos de forma más eficiente.",
    image: "https://images.unsplash.com/photo-1490645935967-10de6ba17061?auto=format&fit=crop&q=80&w=1200",
    thumb: "https://images.unsplash.com/photo-1504674900247-0877df9cc836?auto=format&fit=crop&q=80&w=480",
    date: "15 Ene 2024",
    category: "Nutrición",
    readTime: "5 min",
    slug: "errores-comunes-perder-peso"
  },
  {
    title: "La Mentalidad Ganadora: Cómo Mantener la Motivación",
    excerpt: "La clave del éxito no está solo en el entrenamiento, sino en desarrollar una mentalidad fuerte que te impulse hacia tus metas.",
    image: "https://images.unsplash.com/photo-1571019613454-1cb2f99b2d8b?auto=format&fit=crop&q=80&w=1200",
    thumb: "https://images.unsplash.com/photo-1520975916090-3105956dac38?auto=format&fit=crop&q=80&w=480",
    date: "12 Ene 2024",
    category: "Motivación",
    readTime: "7 min",
    slug: "mentalidad-ganadora-motivacion"
  },
  {
    title: "Rutina de Entrenamiento para Principiantes",
    excerpt: "Si eres nuevo en el gym, esta guía te ayudará a comenzar con el pie derecho y evitar lesiones comunes.",
    image: "https://images.unsplash.com/photo-1594737626071-ad40c076978f?auto=format&fit=crop&q=80&w=1200",
    thumb: "https://images.unsplash.com/photo-1552196563-55cd4e45efb3?auto=format&fit=crop&q=80&w=480",
    date: "10 Ene 2024",
    category: "Entrenamiento",
    readTime: "8 min",
    slug: "rutina-principiantes-gym"
  },
  {
    title: "Los Mejores Alimentos para Ganar Músculo",
    excerpt: "Descubre qué comer para maximizar tus ganancias musculares y optimizar tu recuperación post-entrenamiento.",
    image: "https://images.unsplash.com/photo-1498837167922-ddd27525d352?auto=format&fit=crop&q=80&w=1200",
    thumb: "https://images.unsplash.com/photo-1478147427282-58a87a120781?auto=format&fit=crop&q=80&w=480",
    date: "8 Ene 2024",
    category: "Nutrición",
    readTime: "6 min",
    slug: "alimentos-ganar-musculo"
  },
  {
    title: "Cómo Superar el Estancamiento en el Gym",
    excerpt: "Si sientes que no progresas, estos consejos te ayudarán a romper la meseta y seguir avanzando hacia tus objetivos.",
    image: "https://images.unsplash.com/photo-1517836357463-d25dfeac3438?auto=format&fit=crop&q=80&w=1200",
    thumb: "https://images.unsplash.com/photo-1543975200-8e313fb04b3b?auto=format&fit=crop&q=80&w=480",
    date: "5 Ene 2024",
    category: "Entrenamiento",
    readTime: "9 min",
    slug: "superar-estancamiento-gym"
  },
  {
    title: "DisciplinA: 7 Hábitos para No Abandonar",
    excerpt: "Pequeños hábitos diarios que te mantienen constante incluso cuando falta motivación.",
    image: "https://images.unsplash.com/photo-1517963628607-235ccdd5476e?auto=format&fit=crop&q=80&w=1200", // atleta concentrado
    thumb: "https://images.unsplash.com/photo-1517836357463-d25dfeac3438?auto=format&fit=crop&q=80&w=480",
    date: "2 Ene 2024",
    category: "Motivación",
    readTime: "6 min",
    slug: "habitos-disciplina-gym"
  },
  {
    title: "HIIT vs Cardio Lento: ¿Cuál te Conviene?",
    excerpt: "Compara beneficios, riesgos y cuándo usar cada método para quemar grasa.",
    image: "https://images.unsplash.com/photo-1518611012118-c1d7e9ac53f3?auto=format&fit=crop&q=80&w=1200", // sprint en cinta
    thumb: "https://images.unsplash.com/photo-1546484959-f9a53db89f09?auto=format&fit=crop&q=80&w=480",
    date: "30 Dic 2023",
    category: "Entrenamiento",
    readTime: "7 min",
    slug: "hiit-vs-cardio"
  },
  {
    title: "Desayunos Altos en Proteína para tu Mañana",
    excerpt: "Ideas rápidas, ricas y balanceadas para iniciar el día con energía.",
    image: "https://images.unsplash.com/photo-1540189549336-e6e99c3679fe?auto=format&fit=crop&q=80&w=1200", // bowl proteico
    thumb: "https://images.unsplash.com/photo-1526318472351-c75fcf070305?auto=format&fit=crop&q=80&w=480",
    date: "27 Dic 2023",
    category: "Nutrición",
    readTime: "5 min",
    slug: "desayunos-altos-proteina"
  },
  {
    title: "Piernas Fuertes: Guía de Técnica en Sentadilla",
    excerpt: "Claves para mejorar tu forma, prevenir lesiones y ganar fuerza real.",
    image: "https://images.unsplash.com/photo-1579758629938-03607ccdbaba?auto=format&fit=crop&q=80&w=1200", // sentadilla barra
    thumb: "https://images.unsplash.com/photo-1541537103747-8e9b9b4b8e6b?auto=format&fit=crop&q=80&w=480",
    date: "22 Dic 2023",
    category: "Entrenamiento",
    readTime: "9 min",
    slug: "tecnica-sentadilla"
  }
];
---

<section id="blog" class="px-4 sm:px-6 lg:px-8 bg-gray-900 h-full min-h-full">
  <div class="w-full max-w-[1400px] mx-auto h-full min-h-full flex flex-col">
    <div class="head">
      <h2 class="headline">
        <span class="text-white">Consejos y Tips</span> <span class="text-primary">fitness</span> para mejorar tu rendimiento y salud
      </h2>
    </div>
    <p class="section-sub text-center text-gray-300 max-w-3xl mx-auto">
      Contenidos prácticos y <span class="text-primary">profesionales</span> sobre <span class="text-primary">entrenamiento</span>, <span class="text-primary">nutrición</span> y <span class="text-primary">mentalidad</span> para avanzar con seguridad.
    </p>

    <div class="slider flex-1">
      <div class="track" id="track">
        {blogPosts.map((post, i) => (
          <article class="project-card" {...(i === 0 ? { active: true } : {})}>
            <img class="project-card__bg" src={post.image} alt={post.title} loading="lazy" decoding="async" />
            <div class="project-card__content">
              <img class="project-card__thumb" src={post.thumb || post.image} alt={`${post.title} miniatura`} loading="lazy" decoding="async" />
              <div>
                <h3 class="project-card__title">{post.title}</h3>
                <p class="project-card__desc">{post.excerpt}</p>
                <a href={`/blog/${post.slug}`} class="project-card__btn">Leer más</a>
              </div>
            </div>
          </article>
        ))}
      </div>
    </div>

    <div class="dots" id="dots"></div>
  </div>
</section>

<style>
  :root{
    --gap: 1.25rem;
    --speed: 0.55s cubic-bezier(0.25,0.46,0.45,0.94);
    --closed: 5rem;
    --open: 32rem;
    --accent: var(--tw-color-primary, #4FFF85);
  }
  .head{ max-width:1400px; margin:auto; padding: 1.5rem 0 0.5rem; display:flex; justify-content:center; align-items:flex-end; gap:2rem; }
  .head h2{ font: 900 1.9rem/1.15 Inter, ui-sans-serif, system-ui; color:#fff; text-align:center; letter-spacing:.2px; }
  .headline{ position:relative; display:inline-block; padding-bottom:.6rem; }
  .headline::after{ content:\"\"; position:absolute; left:50%; transform:translateX(-50%); bottom:0; width:72%; height:3px; background: linear-gradient(90deg, transparent, var(--accent), transparent); border-radius:9999px; opacity:.9; }
  .section-sub{ margin-top:.8rem; margin-bottom:.75rem; }
  @media (min-width:1024px){ .head h2{ font-size:2.25rem; } }

  .slider{ max-width:1400px; width:100%; margin:auto; overflow:hidden; height:100%; display:flex; align-items:center; }
  .track{ display:flex; gap:var(--gap); align-items:center; justify-content:center; scroll-behavior:smooth; scroll-snap-type:x mandatory; padding: 0 0 1rem; height:100%; width:100%; }
  .track::-webkit-scrollbar{ display:none; }

  .project-card{ position:relative; flex:0 0 var(--closed); height:min(34rem, 72vh); border-radius:1rem; overflow:hidden; cursor:pointer; transition:flex-basis var(--speed), transform var(--speed); }
  .project-card[active]{ flex-basis: var(--open); transform: translateY(-6px); box-shadow:0 18px 55px rgba(0,0,0,.45); }
  .project-card__bg{ position:absolute; inset:0; width:100%; height:100%; object-fit:cover; filter: brightness(.75) saturate(75%); transition: filter .3s, transform var(--speed); }
  .project-card:hover .project-card__bg{ filter: brightness(.9) saturate(100%); transform: scale(1.06); }

  .project-card__content{ position:absolute; inset:0; display:flex; flex-direction:column; justify-content:center; align-items:center; gap:.7rem; padding:0; background: linear-gradient(transparent 40%, rgba(0,0,0,.85) 100%); z-index:2; }
  .project-card__title{ color:#fff; font-weight:800; font-size:1.25rem; writing-mode: vertical-rl; transform: rotate(180deg); }
  .project-card__thumb, .project-card__desc, .project-card__btn{ display:none; }

  .project-card[active] .project-card__content{ flex-direction:row; align-items:center; padding:1.2rem 2rem; gap:1.1rem; }
  .project-card[active] .project-card__title{ writing-mode: horizontal-tb; transform:none; font-size:1.9rem; }
  .project-card[active] .project-card__thumb, .project-card[active] .project-card__desc, .project-card[active] .project-card__btn{ display:block; }

  .project-card__thumb{ width:133px; height:269px; border-radius:.45rem; object-fit:cover; box-shadow:0 4px 10px rgba(0,0,0,.4); }
  .project-card__desc{ color:#ddd; font-size:1rem; line-height:1.4; max-width:16rem; }
  .project-card__btn{ padding:.55rem 1.3rem; border:none; border-radius:9999px; background: var(--accent); color:#0b0b0b; font-size:.9rem; font-weight:800; cursor:pointer; }
  .project-card__btn:hover{ filter: brightness(1.1); }

  .dots{ display:flex; gap:.5rem; justify-content:center; padding: 0 0 1.25rem; }
  .dot{ width:13px; height:13px; border-radius:50%; background: rgba(255,255,255,.35); cursor:pointer; transition:.3s; }
  .dot.active{ background: var(--accent); transform: scale(1.2); }

  @media(max-width:767px){
    :root{ --closed: 100%; --open:100%; --gap:.8rem; }
    .head{ padding: 1rem 0 0; }
    /* Fuerza área visible para las cards en mobile */
    .slider{ 
      overflow-y: auto; 
      overflow-x: hidden;
      -webkit-overflow-scrolling: touch; 
      flex: 1 1 auto; 
      height: auto; 
      min-height: 40vh;
      max-height: calc(100svh - 180px); 
      width: 100%;
    }
    .track{ flex-direction:column; align-items:stretch; scroll-snap-type: y mandatory; gap:.8rem; padding-bottom:1rem; height:auto; min-height: 1px; width:100%; }
    .project-card{ height:auto; min-height: 16rem; flex:0 0 auto; width:100%; scroll-snap-align:start; }
    .project-card[active]{ min-height: 22rem; transform:none; box-shadow:0 8px 25px rgba(0,0,0,.3); }
    .project-card__content{ flex-direction:row; justify-content:flex-start; padding:1rem; gap:1rem; }
    .project-card__title{ writing-mode: horizontal-tb; transform:none; font-size:1.1rem; margin-right:auto; }
    .project-card__thumb, .project-card__desc, .project-card__btn{ display:none; }
    .project-card[active] .project-card__content{ align-items:flex-start; padding:1.25rem; }
    .project-card[active] .project-card__title{ font-size:1.35rem; margin-top:.5rem; }
  }
</style>

<script>
  const track = document.getElementById('track');
  const wrap = track && track.parentElement;
  const cards = Array.from((track && track.children) || []);
  const dotsBox = document.getElementById('dots');
  const FALLBACK_BG = 'https://images.unsplash.com/photo-1517836357463-d25dfeac3438?auto=format&fit=crop&q=80&w=1200';
  const FALLBACK_THUMB = 'https://images.unsplash.com/photo-1552196563-55cd4e45efb3?auto=format&fit=crop&q=80&w=480';

  const isMobile = () => matchMedia('(max-width:767px)').matches;

  // Build dots
  cards.forEach((_, i) => {
    const dot = document.createElement('span');
    dot.className = 'dot';
    dot.onclick = () => activate(i, true);
    dotsBox.appendChild(dot);
  });
  const dots = Array.from(dotsBox.children);

  let current = 0;

  // Ensure images always present (fallbacks on error)
  document.querySelectorAll('img.project-card__bg').forEach((img)=> {
    img.addEventListener('error', ()=> { img.src = FALLBACK_BG; }, { once: true });
  });
  document.querySelectorAll('img.project-card__thumb').forEach((img)=> {
    img.addEventListener('error', ()=> { img.src = FALLBACK_THUMB; }, { once: true });
  });

  function center(i){
    const card = cards[i];
    const axis = isMobile() ? 'top' : 'left';
    const size = isMobile() ? 'clientHeight' : 'clientWidth';
    // @ts-ignore
    const start = isMobile() ? card.offsetTop : card.offsetLeft;
    // @ts-ignore
    wrap.scrollTo({ [axis]: start - (wrap[size] / 2 - card[size] / 2) });
  }
  function toggleUI(i){
    cards.forEach((c,k)=> c.toggleAttribute('active', k===i));
    dots.forEach((d,k)=> d.classList.toggle('active', k===i));
  }
  function activate(i, scroll){
    if(i===current) return; current=i; toggleUI(i); if(scroll) center(i);
  }
  function go(step){
    const target = Math.min(Math.max(current+step,0), cards.length-1);
    activate(target, true);
  }

  // Keyboard and mouse/touch interactions
  addEventListener('keydown', (e)=>{
    if(['ArrowRight','ArrowDown'].includes(e.key)) go(1);
    if(['ArrowLeft','ArrowUp'].includes(e.key)) go(-1);
  }, { passive: true });

  cards.forEach((card,i)=>{
    card.addEventListener('mouseenter', ()=> matchMedia('(hover:hover)').matches && activate(i,true));
    card.addEventListener('click', ()=> activate(i,true));
  });

  let sx=0, sy=0;
  track && track.addEventListener('touchstart', (e)=>{ sx=e.touches[0].clientX; sy=e.touches[0].clientY; }, {passive:true});
  track && track.addEventListener('touchend', (e)=>{
    const dx = e.changedTouches[0].clientX - sx;
    const dy = e.changedTouches[0].clientY - sy;
    if(isMobile() ? Math.abs(dy)>60 : Math.abs(dx)>60) go((isMobile()? dy: dx)>0 ? -1 : 1);
  }, {passive:true});

  if (window.matchMedia('(max-width:767px)').matches) dotsBox.hidden = true;
  addEventListener('resize', ()=> center(current));
  toggleUI(0); center(0);
</script>


