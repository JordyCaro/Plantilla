---
const blogPosts = [
  {
    title: "5 Errores Comunes que Te Impiden Perder Peso",
    excerpt: "Descubre los errores más frecuentes en la pérdida de peso y cómo evitarlos para alcanzar tus objetivos de forma más eficiente.",
    image: "https://images.unsplash.com/photo-1490645935967-10de6ba17061?auto=format&fit=crop&q=80&w=1200",
    thumb: "https://images.unsplash.com/photo-1504674900247-0877df9cc836?auto=format&fit=crop&q=80&w=480",
    date: "15 Ene 2024",
    category: "Nutrición",
    readTime: "5 min",
    slug: "errores-comunes-perder-peso"
  },
  {
    title: "La Mentalidad Ganadora: Cómo Mantener la Motivación",
    excerpt: "La clave del éxito no está solo en el entrenamiento, sino en desarrollar una mentalidad fuerte que te impulse hacia tus metas.",
    image: "https://images.unsplash.com/photo-1571019613454-1cb2f99b2d8b?auto=format&fit=crop&q=80&w=1200",
    thumb: "https://images.unsplash.com/photo-1520975916090-3105956dac38?auto=format&fit=crop&q=80&w=480",
    date: "12 Ene 2024",
    category: "Motivación",
    readTime: "7 min",
    slug: "mentalidad-ganadora-motivacion"
  },
  {
    title: "Rutina de Entrenamiento para Principiantes",
    excerpt: "Si eres nuevo en el gym, esta guía te ayudará a comenzar con el pie derecho y evitar lesiones comunes.",
    image: "https://images.unsplash.com/photo-1594737626071-ad40c076978f?auto=format&fit=crop&q=80&w=1200",
    thumb: "https://images.unsplash.com/photo-1552196563-55cd4e45efb3?auto=format&fit=crop&q=80&w=480",
    date: "10 Ene 2024",
    category: "Entrenamiento",
    readTime: "8 min",
    slug: "rutina-principiantes-gym"
  },
  {
    title: "Los Mejores Alimentos para Ganar Músculo",
    excerpt: "Descubre qué comer para maximizar tus ganancias musculares y optimizar tu recuperación post-entrenamiento.",
    image: "https://images.unsplash.com/photo-1498837167922-ddd27525d352?auto=format&fit=crop&q=80&w=1200",
    thumb: "https://images.unsplash.com/photo-1478147427282-58a87a120781?auto=format&fit=crop&q=80&w=480",
    date: "8 Ene 2024",
    category: "Nutrición",
    readTime: "6 min",
    slug: "alimentos-ganar-musculo"
  },
  {
    title: "Cómo Superar el Estancamiento en el Gym",
    excerpt: "Si sientes que no progresas, estos consejos te ayudarán a romper la meseta y seguir avanzando hacia tus objetivos.",
    image: "https://images.unsplash.com/photo-1517836357463-d25dfeac3438?auto=format&fit=crop&q=80&w=1200",
    thumb: "https://images.unsplash.com/photo-1543975200-8e313fb04b3b?auto=format&fit=crop&q=80&w=480",
    date: "5 Ene 2024",
    category: "Entrenamiento",
    readTime: "9 min",
    slug: "superar-estancamiento-gym"
  },
  {
    title: "DisciplinA: 7 Hábitos para No Abandonar",
    excerpt: "Pequeños hábitos diarios que te mantienen constante incluso cuando falta motivación.",
    image: "https://images.unsplash.com/photo-1517963628607-235ccdd5476e?auto=format&fit=crop&q=80&w=1200",
    thumb: "https://images.unsplash.com/photo-1517836357463-d25dfeac3438?auto=format&fit=crop&q=80&w=480",
    date: "2 Ene 2024",
    category: "Motivación",
    readTime: "6 min",
    slug: "habitos-disciplina-gym"
  },
  {
    title: "HIIT vs Cardio Lento: ¿Cuál te Conviene?",
    excerpt: "Compara beneficios, riesgos y cuándo usar cada método para quemar grasa.",
    image: "https://images.unsplash.com/photo-1518611012118-c1d7e9ac53f3?auto=format&fit=crop&q=80&w=1200",
    thumb: "https://images.unsplash.com/photo-1546484959-f9a53db89f09?auto=format&fit=crop&q=80&w=480",
    date: "30 Dic 2023",
    category: "Entrenamiento",
    readTime: "7 min",
    slug: "hiit-vs-cardio"
  },
  {
    title: "Desayunos Altos en Proteína para tu Mañana",
    excerpt: "Ideas rápidas, ricas y balanceadas para iniciar el día con energía.",
    image: "https://images.unsplash.com/photo-1540189549336-e6e99c3679fe?auto=format&fit=crop&q=80&w=1200",
    thumb: "https://images.unsplash.com/photo-1526318472351-c75fcf070305?auto=format&fit=crop&q=80&w=480",
    date: "27 Dic 2023",
    category: "Nutrición",
    readTime: "5 min",
    slug: "desayunos-altos-proteina"
  },
  {
    title: "Piernas Fuertes: Guía de Técnica en Sentadilla",
    excerpt: "Claves para mejorar tu forma, prevenir lesiones y ganar fuerza real.",
    image: "https://images.unsplash.com/photo-1579758629938-03607ccdbaba?auto=format&fit=crop&q=80&w=1200",
    thumb: "https://images.unsplash.com/photo-1541537103747-8e9b9b4b8e6b?auto=format&fit=crop&q=80&w=480",
    date: "22 Dic 2023",
    category: "Entrenamiento",
    readTime: "9 min",
    slug: "tecnica-sentadilla"
  }
];
---

<section id="blog" class="blog-section">
  <div class="blog-container">
    <!-- Section Header -->
    <div class="blog-header">
      <h2 class="blog-title">
        <span class="blog-title-text">Consejos y Tips</span> <span class="blog-title-accent">fitness</span> para mejorar tu rendimiento y salud
      </h2>
      <p class="blog-subtitle">
        Contenidos prácticos y <span class="blog-subtitle-accent">profesionales</span> sobre <span class="blog-subtitle-accent">entrenamiento</span>, <span class="blog-subtitle-accent">nutrición</span> y <span class="blog-subtitle-accent">mentalidad</span> para avanzar con seguridad.
      </p>
    </div>

    <!-- Slider -->
    <div class="blog-slider">
      <div class="blog-track" id="blog-track">
        {blogPosts.map((post, i) => (
          <article class="blog-card" data-index={i} {...(i === 0 ? { 'data-active': true } : {})}>
            <img class="blog-card-bg" src={post.image} alt={post.title} loading="lazy" decoding="async" />
            <div class="blog-card-content">
              <img class="blog-card-thumb" src={post.thumb || post.image} alt={`${post.title} miniatura`} loading="lazy" decoding="async" />
              <div class="blog-card-text">
                <h3 class="blog-card-title">{post.title}</h3>
                <p class="blog-card-desc">{post.excerpt}</p>
                <a href={`/blog/${post.slug}`} class="blog-card-btn">Leer más</a>
              </div>
            </div>
          </article>
        ))}
      </div>
    </div>

    <!-- Dots Navigation -->
    <div class="blog-dots" id="blog-dots"></div>
  </div>
</section>

<style>
  /* Blog Section - Sin scroll interno, todo debe caber */
  .blog-section {
    position: relative;
    width: 100%;
    min-height: 100svh;
    display: flex;
    align-items: stretch;
    justify-content: stretch;
    overflow: hidden;
    box-sizing: border-box;
    background-color: #111827;
  }

  .blog-container {
    position: relative;
    z-index: 10;
    width: 100%;
    max-width: 1400px;
    margin: 0 auto;
    height: 100svh;
    min-height: 100svh;
    display: flex;
    flex-direction: column;
    padding: var(--header-h, 64px) clamp(1rem, 4vw, 2rem) clamp(0.125rem, 0.5svh, 0.5rem);
    padding-top: var(--header-h, 64px);
    padding-bottom: clamp(0.125rem, 0.5svh, 0.5rem);
    box-sizing: border-box;
  }

  /* Header */
  .blog-header {
    text-align: center;
    padding: clamp(0.75rem, 2svh, 1.5rem) 0;
    flex-shrink: 0;
    box-sizing: border-box;
  }

  .blog-title {
    font-size: clamp(1.75rem, 6vw, 2.25rem);
    font-weight: 900;
    color: #ffffff;
    line-height: 1.15;
    margin: 0 0 clamp(0.5rem, 1.5svh, 0.75rem) 0;
    letter-spacing: 0.02em;
    position: relative;
    display: inline-block;
    padding-bottom: clamp(0.4rem, 1.2svh, 0.6rem);
  }

  .blog-title::after {
    content: "";
    position: absolute;
    left: 50%;
    transform: translateX(-50%);
    bottom: 0;
    width: 72%;
    height: 3px;
    background: linear-gradient(90deg, transparent, #00FF88, transparent);
    border-radius: 9999px;
    opacity: 0.9;
  }

  .blog-title-text {
    color: #ffffff;
  }

  .blog-title-accent {
    color: #00FF88;
  }

  .blog-subtitle {
    font-size: clamp(0.9375rem, 2.2svh, 1.125rem);
    color: #d1d5db;
    max-width: 48rem;
    margin: 0 auto;
    line-height: 1.5;
  }

  .blog-subtitle-accent {
    color: #00FF88;
  }

  /* Slider */
  .blog-slider {
    flex: 1;
    max-width: 1400px;
    width: 100%;
    margin: 0 auto;
    overflow: hidden;
    display: flex;
    align-items: center;
    min-height: 0;
    box-sizing: border-box;
  }

  .blog-track {
    display: flex;
    gap: clamp(0.8rem, 2svh, 1.25rem);
    align-items: center;
    justify-content: center;
    scroll-behavior: smooth;
    scroll-snap-type: x mandatory;
    padding: 0 0 clamp(0.5rem, 1.5svh, 1rem);
    height: 100%;
    width: 100%;
    overflow-x: auto;
    overflow-y: hidden;
    scrollbar-width: none;
    -ms-overflow-style: none;
    -webkit-overflow-scrolling: touch;
    box-sizing: border-box;
  }

  .blog-track::-webkit-scrollbar {
    display: none;
  }

  /* Cards */
  .blog-card {
    position: relative;
    flex: 0 0 clamp(5rem, 12vw, 8rem);
    height: min(32rem, 60dvh);
    border-radius: 1rem;
    overflow: visible;
    cursor: pointer;
    transition: flex-basis 0.55s cubic-bezier(0.25, 0.46, 0.45, 0.94), transform 0.55s cubic-bezier(0.25, 0.46, 0.45, 0.94);
    scroll-snap-align: center;
    scroll-snap-stop: always;
    box-sizing: border-box;
  }

  .blog-card-bg {
    overflow: hidden;
    border-radius: 1rem;
  }

  .blog-card[data-active] {
    flex-basis: clamp(20rem, 50vw, 32rem);
    transform: translateY(-6px);
    box-shadow: 0 18px 55px rgba(0, 0, 0, 0.45);
  }

  .blog-card-bg {
    position: absolute;
    inset: 0;
    width: 100%;
    height: 100%;
    object-fit: cover;
    filter: brightness(0.75) saturate(75%);
    transition: filter 0.3s, transform 0.55s cubic-bezier(0.25, 0.46, 0.45, 0.94);
  }

  .blog-card:hover .blog-card-bg {
    filter: brightness(0.9) saturate(100%);
    transform: scale(1.06);
  }

  .blog-card-content {
    position: absolute;
    inset: 0;
    display: flex;
    flex-direction: column;
    justify-content: center;
    align-items: center;
    gap: 0.7rem;
    padding: 0;
    background: linear-gradient(transparent 40%, rgba(0, 0, 0, 0.85) 100%);
    z-index: 2;
    box-sizing: border-box;
    overflow: visible;
  }

  .blog-card[data-active] .blog-card-content {
    flex-direction: row;
    align-items: center;
    padding: clamp(1rem, 2.5svh, 1.5rem) clamp(1.5rem, 4vw, 2rem);
    gap: clamp(1rem, 2.5svh, 1.5rem);
  }

  .blog-card-title {
    color: #ffffff;
    font-weight: 800;
    font-size: clamp(1rem, 2.5svh, 1.25rem);
    writing-mode: vertical-rl;
    transform: rotate(180deg);
    margin: 0;
    word-wrap: break-word;
    overflow-wrap: break-word;
  }

  .blog-card[data-active] .blog-card-title {
    writing-mode: horizontal-tb;
    transform: none;
    font-size: clamp(1.5rem, 4vw, 1.9rem);
    line-height: 1.2;
  }

  .blog-card-thumb,
  .blog-card-desc,
  .blog-card-btn {
    display: none;
  }

  .blog-card[data-active] .blog-card-thumb,
  .blog-card[data-active] .blog-card-desc,
  .blog-card[data-active] .blog-card-btn {
    display: block;
  }

  .blog-card-text {
    display: flex;
    flex-direction: column;
    gap: clamp(0.75rem, 2svh, 1rem);
    flex: 1;
    min-width: 0;
  }

  .blog-card-thumb {
    width: clamp(100px, 25vw, 133px);
    height: clamp(200px, 50vw, 269px);
    border-radius: 0.45rem;
    object-fit: cover;
    box-shadow: 0 4px 10px rgba(0, 0, 0, 0.4);
    flex-shrink: 0;
  }

  .blog-card-desc {
    color: #dddddd;
    font-size: clamp(0.875rem, 2svh, 1rem);
    line-height: 1.4;
    max-width: 16rem;
    margin: 0;
    word-wrap: break-word;
    overflow-wrap: break-word;
  }

  .blog-card-btn {
    padding: clamp(0.5rem, 1.5svh, 0.75rem) clamp(1rem, 2.5vw, 1.5rem);
    border: none;
    border-radius: 9999px;
    background-color: #00FF88;
    color: #0b0b0b;
    font-size: clamp(0.8125rem, 2svh, 0.9rem);
    font-weight: 800;
    cursor: pointer;
    text-decoration: none;
    display: inline-block;
    transition: filter 0.3s;
    align-self: flex-start;
  }

  .blog-card-btn:hover {
    filter: brightness(1.1);
  }

  /* Dots */
  .blog-dots {
    display: flex;
    gap: 0.5rem;
    justify-content: center;
    padding: clamp(0.5rem, 1.5svh, 1rem) 0;
    flex-shrink: 0;
    box-sizing: border-box;
  }

  .blog-dot {
    width: 13px;
    height: 13px;
    border-radius: 50%;
    background-color: rgba(255, 255, 255, 0.35);
    cursor: pointer;
    transition: all 0.3s;
    border: none;
    padding: 0;
  }

  .blog-dot.active {
    background-color: #00FF88;
    transform: scale(1.2);
  }

  /* Responsive - Mobile */
  @media (max-width: 767px) {
    .blog-container {
      padding: 0 clamp(1rem, 4vw, 1.5rem) clamp(0.125rem, 0.5svh, 0.5rem);
      padding-top: var(--header-h, 64px);
      height: 100svh;
      min-height: 100svh;
    }
    .blog-header {
      padding: clamp(0.5rem, 1.5svh, 1rem) 0 clamp(0.25rem, 1svh, 0.5rem);
    }
    .blog-title {
      font-size: clamp(1.5rem, 5vw, 2rem);
      margin-bottom: clamp(0.375rem, 1svh, 0.5rem);
      padding-bottom: clamp(0.3rem, 1svh, 0.5rem);
    }
    .blog-subtitle {
      font-size: clamp(0.875rem, 2svh, 1rem);
    }
    .blog-slider {
      overflow-y: auto;
      overflow-x: hidden;
      -webkit-overflow-scrolling: touch;
      flex: 1;
      height: auto;
      min-height: 0;
      padding-top: 0;
    }
    .blog-track {
      flex-direction: column;
      align-items: stretch;
      scroll-snap-type: y mandatory;
      gap: clamp(0.75rem, 2svh, 1rem);
      padding: 0 0 clamp(0.5rem, 1.5svh, 1rem);
      height: auto;
      min-height: 1px;
      width: 100%;
      overflow-x: hidden;
      overflow-y: auto;
      align-content: start;
      scroll-padding-top: 0;
    }
    .blog-card {
      height: auto;
      min-height: clamp(10rem, 25svh, 14rem);
      flex: 0 0 auto;
      width: 100%;
      scroll-snap-align: start;
      scroll-snap-stop: always;
      max-height: none;
      overflow: visible;
      display: flex;
      flex-direction: column;
      margin: 0;
      padding: 0;
    }
    .blog-card-bg {
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      width: 100%;
      height: 100%;
      border-radius: 1rem;
      overflow: hidden;
      z-index: 0;
      object-fit: cover;
    }
    .blog-card-content {
      position: relative;
      z-index: 1;
      flex: 1;
      display: flex;
      flex-direction: row;
      justify-content: flex-start;
      align-items: flex-start;
      padding: clamp(0.75rem, 2svh, 1.25rem);
      gap: clamp(0.75rem, 2svh, 1rem);
      min-height: 100%;
      overflow: visible;
      background: linear-gradient(to bottom, transparent 0%, transparent 30%, rgba(0, 0, 0, 0.7) 70%, rgba(0, 0, 0, 0.9) 100%);
      border-radius: 1rem;
      margin: 0;
      box-sizing: border-box;
    }
    .blog-card[data-active] {
      min-height: clamp(14rem, 35svh, 20rem);
      transform: none;
      box-shadow: 0 8px 25px rgba(0, 0, 0, 0.3);
    }
    .blog-card[data-active] .blog-card-content {
      min-height: auto;
      padding: clamp(0.875rem, 2svh, 1.25rem);
    }
    .blog-card-title {
      writing-mode: horizontal-tb;
      transform: none;
      font-size: clamp(1rem, 2.5svh, 1.35rem);
      margin: 0;
      line-height: 1.3;
    }
    .blog-card-thumb,
    .blog-card-desc,
    .blog-card-btn {
      display: none;
    }
    .blog-card[data-active] .blog-card-content {
      align-items: flex-start;
      padding: clamp(0.875rem, 2svh, 1.25rem);
      gap: clamp(0.75rem, 2svh, 1rem);
    }
    .blog-card[data-active] .blog-card-title {
      font-size: clamp(1.125rem, 3vw, 1.5rem);
      margin-bottom: clamp(0.5rem, 1.5svh, 0.75rem);
      line-height: 1.2;
    }
    .blog-card[data-active] .blog-card-thumb,
    .blog-card[data-active] .blog-card-desc,
    .blog-card[data-active] .blog-card-btn {
      display: block;
    }
    .blog-card-text {
      flex: 1;
      min-width: 0;
      display: flex;
      flex-direction: column;
      gap: clamp(0.5rem, 1.5svh, 0.75rem);
    }
    .blog-card-thumb {
      width: clamp(70px, 18vw, 100px);
      height: clamp(100px, 25vw, 150px);
      flex-shrink: 0;
    }
    .blog-card-desc {
      font-size: clamp(0.8125rem, 1.8svh, 0.9375rem);
      max-width: 100%;
      margin: 0;
      line-height: 1.4;
      flex: 1;
    }
    .blog-card-btn {
      padding: clamp(0.5rem, 1.5svh, 0.625rem) clamp(1rem, 2.5vw, 1.25rem);
      font-size: clamp(0.75rem, 1.8svh, 0.875rem);
      align-self: flex-start;
      margin-top: auto;
    }
    .blog-dots {
      display: none;
    }
  }

  /* Responsive - Tablet */
  @media (min-width: 768px) and (max-width: 1023px) {
    .blog-header {
      padding: clamp(1rem, 2.5svh, 1.5rem) 0;
    }
    .blog-title {
      font-size: clamp(2rem, 7vw, 2.25rem);
    }
    .blog-subtitle {
      font-size: clamp(1rem, 2.5svh, 1.125rem);
    }
  }

  /* Responsive - Desktop */
  @media (min-width: 1024px) {
    .blog-header {
      padding: clamp(1.25rem, 3svh, 2rem) 0;
    }
    .blog-title {
      font-size: clamp(2.25rem, 8vw, 2.5rem);
    }
    .blog-subtitle {
      font-size: clamp(1.125rem, 2.8svh, 1.25rem);
    }
  }

  /* Fallback para pantallas con poca altura */
  @media (max-height: 600px) {
    .blog-header {
      padding: clamp(0.5rem, 1.2svh, 0.75rem) 0;
    }
    .blog-title {
      font-size: clamp(1.5rem, 5vw, 1.75rem);
      margin-bottom: clamp(0.25rem, 0.8svh, 0.5rem);
      padding-bottom: clamp(0.25rem, 0.8svh, 0.4rem);
    }
    .blog-subtitle {
      font-size: clamp(0.8125rem, 1.8svh, 0.95rem);
    }
    .blog-card {
      height: min(28rem, 55dvh);
    }
    .blog-card[data-active] {
      min-height: clamp(16rem, 40svh, 20rem);
    }
  }
</style>

<script is:inline>
  (function() {
    const track = document.getElementById('blog-track');
    const wrap = track && track.parentElement;
    const cards = Array.from((track && track.children) || []);
    const dotsBox = document.getElementById('blog-dots');
    const FALLBACK_BG = 'https://images.unsplash.com/photo-1517836357463-d25dfeac3438?auto=format&fit=crop&q=80&w=1200';
    const FALLBACK_THUMB = 'https://images.unsplash.com/photo-1552196563-55cd4e45efb3?auto=format&fit=crop&q=80&w=480';

    const isMobile = () => matchMedia('(max-width:767px)').matches;

    // Build dots
    if (dotsBox && cards.length > 0) {
      cards.forEach((_, i) => {
        const dot = document.createElement('button');
        dot.className = 'blog-dot';
        dot.setAttribute('aria-label', `Ir al artículo ${i + 1}`);
        dot.onclick = () => activate(i, true);
        dotsBox.appendChild(dot);
      });
    }
    const dots = Array.from((dotsBox && dotsBox.children) || []);

    let current = 0;

    // Ensure images always present (fallbacks on error)
    document.querySelectorAll('img.blog-card-bg').forEach((img) => {
      img.addEventListener('error', () => { img.src = FALLBACK_BG; }, { once: true });
    });
    document.querySelectorAll('img.blog-card-thumb').forEach((img) => {
      img.addEventListener('error', () => { img.src = FALLBACK_THUMB; }, { once: true });
    });

    function center(i) {
      if (!cards[i] || !wrap) return;
      const card = cards[i];
      const axis = isMobile() ? 'top' : 'left';
      const size = isMobile() ? 'clientHeight' : 'clientWidth';
      const start = isMobile() ? card.offsetTop : card.offsetLeft;
      wrap.scrollTo({ [axis]: start - (wrap[size] / 2 - card[size] / 2), behavior: 'smooth' });
    }

    function toggleUI(i) {
      cards.forEach((c, k) => c.toggleAttribute('data-active', k === i));
      dots.forEach((d, k) => d.classList.toggle('active', k === i));
    }

    function activate(i, scroll) {
      if (i === current || i < 0 || i >= cards.length) return;
      current = i;
      toggleUI(i);
      if (scroll) center(i);
    }

    function go(step) {
      const target = Math.min(Math.max(current + step, 0), cards.length - 1);
      activate(target, true);
    }

    // Keyboard and mouse/touch interactions
    addEventListener('keydown', (e) => {
      if (['ArrowRight', 'ArrowDown'].includes(e.key)) go(1);
      if (['ArrowLeft', 'ArrowUp'].includes(e.key)) go(-1);
    }, { passive: true });

    cards.forEach((card, i) => {
      card.addEventListener('mouseenter', () => {
        if (matchMedia('(hover:hover)').matches) activate(i, true);
      });
      card.addEventListener('click', () => activate(i, true));
    });

    let sx = 0, sy = 0;
    if (track) {
      track.addEventListener('touchstart', (e) => {
        sx = e.touches[0].clientX;
        sy = e.touches[0].clientY;
      }, { passive: true });
      track.addEventListener('touchend', (e) => {
        const dx = e.changedTouches[0].clientX - sx;
        const dy = e.changedTouches[0].clientY - sy;
        if (isMobile() ? Math.abs(dy) > 60 : Math.abs(dx) > 60) {
          go((isMobile() ? dy : dx) > 0 ? -1 : 1);
        }
      }, { passive: true });
    }

    if (window.matchMedia('(max-width:767px)').matches && dotsBox) {
      dotsBox.style.display = 'none';
    }
    addEventListener('resize', () => center(current));
    if (cards.length > 0) {
      toggleUI(0);
      center(0);
    }
  })();
</script>
